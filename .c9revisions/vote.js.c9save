{"ts":1365587943674,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var socket = null;\r\n\r\nvar can = document.getElementById(\"canvas\");\r\nvar ctx = can.getContext(\"2d\");\r\nvar colours = new Array('#FF0000','0000FF','#00FF00','FF00FF','#FFFF00','00FFFF');\r\n    \r\n\r\nfunction init(){\r\n    connect();    \r\n}\r\n\r\nfunction connect() {\r\n    log('Connecting to local server...');\r\n    if (socket == null) {\r\n        socket = io.connect(null,{'auto connect': false});\r\n        socket.on('connect', function () {\r\n             status('Connected');\r\n        });\r\n        \r\n        socket.on('message', function (data) {\r\n            \r\n            try {\r\n                var json = JSON.parse(data);\r\n            } catch (e) {\r\n                console.log('This doesn\\'t look like a valid JSON: ', data);\r\n                return;\r\n            }\r\n            \r\n            if (json.type=='message'){\r\n                //log(json.type);\r\n                log(json.data);\r\n            }\r\n            \r\n            if (json.type=='votes'){\r\n                updateVotes(json.data);            \r\n            }\r\n            \r\n        });\r\n    }\r\n    socket.socket.connect();\r\n}\r\n\r\nfunction send() {\r\n    if (socket && socket.socket.connected) {\r\n        socket.send(JSON.stringify({ type:'message', data:document.getElementById('text').value}));\r\n        log('>' + document.getElementById('text').value);\r\n    } else {\r\n        log('Not connected.');\r\n    }\r\n}\r\n\r\nfunction updateVotes(data){\r\n    \r\n    ctx.fillStyle = \"#eee\";\r\n    ctx.fillRect(0,0,350,350);\r\n    \r\n    var votes = data;\r\n    \r\n    var barWidth = 350 / votes.length;\r\n    \r\n    var totalVotes = 0;\r\n    for (var i=0; i < votes.length; i++) {\r\n        totalVotes += votes[i].numVotes;\r\n    }\r\n    \r\n    for (var i=0; i < votes.length; i++) {\r\n    \r\n        var pct = votes[i].numVotes / totalVotes;\r\n        var barHeight = 350 * pct;\r\n        document.getElementById('vote' + votes[i].name).innerHTML = votes[i].numVotes + ' (' + (pct * 100) + '%)';\r\n    \r\n        ctx.fillStyle = colours[i];\r\n        ctx.fillRect(i*barWidth,(350 - barHeight),barWidth,barHeight);\r\n    \r\n    }\r\n    \r\n\r\n\r\n}\r\n\r\nfunction vote(option) {\r\n    if (socket && socket.socket.connected) {\r\n        \r\n        socket.send(JSON.stringify({ type:'vote', data: option }));\r\n    } else {\r\n        log('Not connected.');\r\n    }\r\n}\r\n\r\nfunction update() {\r\n    if (socket && socket.socket && socket.socket.transport) {\r\n        document.getElementById('sessionId').textContent = socket.socket.transport.sessid;\r\n        document.getElementById('transport').textContent = socket.socket.transport.name;\r\n    } else {\r\n        document.getElementById('sessionId').textContent = '-';\r\n        document.getElementById('transport').textContent = '-';\r\n    }\r\n}\r\n\r\nsetInterval(update, 10);"]],"start1":0,"start2":0,"length1":0,"length2":2722}]],"length":2722}
{"contributors":[],"silentsave":false,"ts":1365591338439,"patch":[[{"diffs":[[-1,"var socket = null;\r\n\r\nvar can = document.getElementById(\"canvas\");\r\nvar ctx = can.getContext(\"2d\");\r\nvar colours = new Array('#FF0000','0000FF','#00FF00','FF00FF','#FFFF00','00FFFF');\r\n    \r\n\r\nfunction init(){\r\n    connect();    \r\n}\r\n\r\nfunction connect() {\r\n    log('Connecting to local server...');\r\n    if (socket == null) {\r\n        socket = io.connect(null,{'auto connect': false});\r\n        socket.on('connect', function () {\r\n             status('Connected');\r\n        });\r\n        \r\n        socket.on('message', function (data) {\r\n            \r\n            try {\r\n                var json = JSON.parse(data);\r\n            } catch (e) {\r\n                console.log('This doesn\\'t look like a valid JSON: ', data);\r\n                return;\r\n            }\r\n            \r\n            if (json.type=='message'){\r\n                //log(json.type);\r\n                log(json.data);\r\n            }\r\n            \r\n            if (json.type=='votes'){\r\n                updateVotes(json.data);            \r\n            }\r\n            \r\n        });\r\n    }\r\n    socket.socket.connect();\r\n}\r\n"],[1,"\r\n\r\n// send message from text box thing"],[0,"\r\nfu"]],"start1":0,"start2":0,"length1":1090,"length2":43},{"diffs":[[0,");\r\n    }\r\n}\r\n\r\n"],[1,"\r\nvar can = document.getElementById(\"canvas\");\r\nvar ctx = can.getContext(\"2d\");\r\nvar colours = new Array('#FF0000','0000FF','#00FF00','FF00FF','#FFFF00','00FFFF');\r\n\r\n"],[0,"function updateV"]],"start1":308,"start2":308,"length1":32,"length2":199},{"diffs":[[0,"\r\n\r\n"],[-1,"function update() {\r\n    if (socket && socket.socket && socket.socket.transport) {\r\n        document.getElementById('sessionId').textContent = socket.socket.transport.sessid;\r\n        document.getElementById('transport').textContent = socket.socket.transport.name;\r\n    } else {\r\n        document.getElementById('sessionId').textContent = '-';\r\n        document.getElementById('transport').textContent = '-';\r\n    }\r\n}\r\n\r\nsetInterval(update, 10);"]],"start1":1392,"start2":1392,"length1":450,"length2":4}]],"length":1396,"saved":false}
{"ts":1365591774055,"patch":[[{"diffs":[[1,"\r\nsocket.on('message', function (data) {\r\n    \r\n    try {\r\n        var json = JSON.parse(data);\r\n    } catch (e) {\r\n        console.log('This doesn\\'t look like a valid JSON: ', data);\r\n        return;\r\n    }\r\n    \r\n    if (json.type=='message'){\r\n        //log(json.type);\r\n        log(json.data);\r\n    }\r\n    \r\n    if (json.type=='votes'){\r\n        updateVotes(json.data);            \r\n    }\r\n    \r\n});\r\n"],[0,"\r\n\r\n// send "]],"start1":0,"start2":0,"length1":12,"length2":418}]],"length":1802,"saved":false}
{"ts":1365591844857,"patch":[[{"diffs":[[0,"\r\n"],[1,"function vote_connect(){\r\n    "],[0,"socket.o"]],"start1":0,"start2":0,"length1":10,"length2":40},{"diffs":[[0," {\r\n    "],[1,"    "],[0,"\r\n    "],[1," "],[1,"   "],[0,"try {\r\n "]],"start1":68,"start2":68,"length1":22,"length2":30},{"diffs":[[0," {\r\n        "],[1,"  "],[1,"  "],[0,"var json = J"]],"start1":93,"start2":93,"length1":24,"length2":28},{"diffs":[[0,"rse(data);\r\n"],[1,"    "],[0,"    } catch "]],"start1":127,"start2":127,"length1":24,"length2":28},{"diffs":[[0,"atch (e) {\r\n"],[1,"    "],[0,"        cons"]],"start1":150,"start2":150,"length1":24,"length2":28},{"diffs":[[0,"        "],[1,"   "],[1," "],[0,"return;\r"]],"start1":236,"start2":236,"length1":16,"length2":20},{"diffs":[[0,"eturn;\r\n"],[1,"    "],[0,"    }\r\n "]],"start1":249,"start2":249,"length1":16,"length2":20},{"diffs":[[0,"\n        }\r\n    "],[1,"  "],[-1,"\r\n"],[1,"  \r\n    "],[0,"    if (json.typ"]],"start1":256,"start2":256,"length1":34,"length2":42},{"diffs":[[0,"        "],[1,"    "],[0,"//log(js"]],"start1":314,"start2":314,"length1":16,"length2":20},{"diffs":[[0,");\r\n        "],[1,"   "],[1," "],[0,"log(json.dat"]],"start1":341,"start2":341,"length1":24,"length2":28},{"diffs":[[0,"son.data);\r\n"],[1,"    "],[0,"    }\r\n    \r"]],"start1":362,"start2":362,"length1":24,"length2":28},{"diffs":[[0,"     }\r\n    "],[1," "],[-1,"\r\n"],[1,"   \r\n    "],[0,"    if (json"]],"start1":377,"start2":377,"length1":26,"length2":34},{"diffs":[[0,"='votes'){\r\n"],[1,"    "],[0,"        upda"]],"start1":417,"start2":417,"length1":24,"length2":28},{"diffs":[[0,"    "],[1,"  "],[1,"  "],[0,"}\r\n    "],[1,"  "],[1,"  \r\n    });"],[0,"\r\n}"],[-1,");"],[0,"\r\n\r\n"]],"start1":478,"start2":478,"length1":20,"length2":35}]],"length":1907,"saved":false}
{"ts":1365592079780,"patch":[[{"diffs":[[0,"on vote_"],[1,"on"],[0,"connect("]],"start1":8,"start2":8,"length1":16,"length2":18},{"diffs":[[0,"){\r\n"],[-1,"    socket.on('message', function (data) {\r\n        \r\n        try {\r\n            var json = JSON.parse(data);\r\n        } catch (e) {\r\n            console.log('This doesn\\'t look like a valid JSON: ', data);\r\n            return;\r\n        }\r\n        \r\n    "],[1,"\r\n}\r\n\r\nfunction vote_onmessage(json){\r\n \r\n"],[0,"    "]],"start1":26,"start2":26,"length1":262,"length2":50},{"diffs":[[0,"        "],[-1,"    "],[0,"//log(js"]],"start1":104,"start2":104,"length1":20,"length2":16},{"diffs":[[0,"son.type);\r\n"],[-1,"    "],[0,"        log("]],"start1":119,"start2":119,"length1":28,"length2":24},{"diffs":[[0,"son.data);\r\n"],[-1,"    "],[0,"    }\r\n     "]],"start1":144,"start2":144,"length1":28,"length2":24},{"diffs":[[0," }\r\n    "],[-1," "],[-1,"   "],[0,"\r\n    "],[-1," "],[-1,"   "],[0,"if (json"]],"start1":159,"start2":159,"length1":30,"length2":22},{"diffs":[[0,"='votes'){\r\n"],[-1,"    "],[0,"        upda"]],"start1":187,"start2":187,"length1":28,"length2":24},{"diffs":[[0,"    "],[-1,"  "],[-1,"  "],[0,"}\r\n"],[-1,"        \r\n    });"],[1,"\r\n"],[0,"\r\n}\r"]],"start1":244,"start2":244,"length1":32,"length2":13}]],"length":1654,"saved":false}
